<?xml version="1.0" encoding="utf-8" ?>
<feed xmlns="http://www.w3.org/2005/Atom"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n">
<metal:block
    define-macro="master"
    tal:define="syn context/portal_syndication;
                context_state nocall:context/@@plone_context_state;
                portal_state nocall:context/@@plone_portal_state;
                dummy python:request.RESPONSE.setHeader('Content-Type', 'application/atom+xml;;charset=utf-8')">

    <title tal:content="context/pretty_title_or_id">Title</title>
    <subtitle tal:condition="context/Description" tal:content="context/Description">Description</subtitle>
    <link href="http://example.org/feed/" rel="self" tal:attributes="href request/URL"/>
    <link href="http://example.org/" tal:attributes="href context/absolute_url"/>
    <id tal:condition="context_state/is_portal_root" tal:content="string:${portal_state/portal_url}/">urn:uuid:60a76c80-d399-11d9-b91C-0003939e0af6</id>
    <id tal:condition="not:context_state/is_portal_root" tal:content="python:view.atom_id_tag(context)">urn:uuid:60a76c80-d399-11d9-b91C-0003939e0af6</id>
    <updated tal:content="context/ModificationDate">2003-12-13T18:30:02Z</updated>

    <tal:block condition="context_state/is_portal_root">
    <tal:block define="objects view/filtered" repeat="brain python: objects.values()">
    <entry tal:define="obj_item brain/object;
                    has_effective exists:obj_item/aq_explicit/effective_date;
                    effective python:has_effective and obj_item.effective().HTML4() or '';
                    modified python:obj_item.modified.HTML4();
                    creator obj_item/Creator|nothing;
                    image python: obj_item.getObject().getImage();">
        <title tal:content="obj_item/pretty_title_or_id">Atom-Powered Robots Run Amok</title>
        <link href="http://example.org/2003/12/13/atom03" tal:attributes="href obj_item/Identifier" />
        <link rel="alternate" type="text/html" href="http://example.org/2003/12/13/atom03.html" tal:attributes="href string:${obj_item/Identifier}" />
        <link rel="edit" href="http://example.org/2003/12/13/atom03/edit" tal:attributes="href string:${obj_item/Identifier}/edit" />
        <link tal:condition="image" tal:define="img image" rel="enclosure" tal:attributes="type img/content_type; length img/getSize; href img/absolute_url" type="image/jpeg" length="54079" href="http://warp.com.mx/sites%2Fall%2Ffiles%2Fthe-vaccines2_2_0.jpg"/>
        <id tal:content="python:view.atom_id_tag(obj_item.getObject())">urn:uuid:60a76c80-d399-11d9-b91C-0003939e0af6</id>
        <author tal:define="creator obj_item/Creator|nothing;
                            getMemberInfo nocall:context/portal_membership/getMemberInfo;
                            author python:getMemberInfo(creator);
                            member python:context.portal_membership.getMemberById(creator);">
            <name tal:content="python:author and author['fullname'] or creator">No name</name>
        </author>
        <updated tal:content="modified">2003-12-13T18:30:02Z</updated>
        <summary tal:content="obj_item/Description">Some text.</summary>
        <content type="text/html" src="http://example.org/2003/12/13/atom03.html" tal:attributes="src string:${obj_item/Identifier}" />
        <tal:cat condition="python: len(brain['categories'])" repeat="cat brain/categories"><category term="" label="" tal:attributes="term python: cat[0]; label python: cat[1];" /></tal:cat>
    </entry>
    </tal:block>
    </tal:block>

    <tal:block condition="not:context_state/is_portal_root">
    <tal:block define="objectList python:list(view.results); objects python: objectList;" repeat="brain python: objects">
    <entry tal:define="obj_item brain/getObject|nocall:brain;
                    has_effective exists:obj_item/aq_explicit/effective_date;
                    effective python:has_effective and obj_item.effective().HTML4() or '';
                    modified python:obj_item.modified().HTML4();
                    creator obj_item/Creator|nothing;
                    image python: obj_item.getImage()|nothing;">
        <title tal:content="obj_item/pretty_title_or_id">Atom-Powered Robots Run Amok</title>
        <link href="http://example.org/2003/12/13/atom03" tal:attributes="href obj_item/Identifier" />
        <link rel="alternate" type="text/html" href="http://example.org/2003/12/13/atom03.html" tal:attributes="href string:${obj_item/Identifier}" />
        <link rel="edit" href="http://example.org/2003/12/13/atom03/edit" tal:attributes="href string:${obj_item/Identifier}/edit" />
        <link tal:condition="image" tal:define="img image" rel="enclosure" tal:attributes="type img/content_type; length img/getSize; href img/absolute_url" type="image/jpeg" length="54079" href="http://warp.com.mx/sites%2Fall%2Ffiles%2Fthe-vaccines2_2_0.jpg"/>
        <id tal:content="python:view.atom_id_tag(obj_item)">urn:uuid:60a76c80-d399-11d9-b91C-0003939e0af6</id>
        <author tal:define="creator obj_item/Creator|nothing;
                            getMemberInfo nocall:context/portal_membership/getMemberInfo;
                            author python:getMemberInfo(creator);
                            member python:context.portal_membership.getMemberById(creator);">
            <name tal:content="python:author and author['fullname'] or creator">No name</name>
        </author>
        <updated tal:content="modified">2003-12-13T18:30:02Z</updated>
        <summary tal:content="obj_item/Description">Some text.</summary>
        <content type="text/html" src="http://example.org/2003/12/13/atom03.html" tal:attributes="src string:${obj_item/Identifier}" />
    </entry>
    </tal:block>
    </tal:block>

</metal:block>
</feed>
